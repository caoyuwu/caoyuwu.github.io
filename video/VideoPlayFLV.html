<!DOCTYPE HTML>

<html class="ui-fullpage">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type='text/javascript' src='../xjslib/xjs-base.js'></script>
<link rel="icon" href="video-64.png"/>
<script type='text/javascript' src="../jslib/flvjs/flv.js"></script>
<script type='text/javascript' src='../xjslib/video/VideoPlay.js'></script>

<title>FLV视频播放</title>
<script type="text/javascript">
  /*
   http://www.caoyuwu.top/video/VideoPlayFLV.html
  
  */
  var consolePane ; 
  // var videoElement;
  // var flvPlayer;
  var videoPlayer;
   function consoleLog(s)
   {
	   consolePane.addMessage(s);
   }
   /*
  function onVideoPlayReady(){
	  window.console.log("onVideoPlayReady...");
	 // consoleLog("onVideoPlayReady...");
	  
  };
  
  function on_loadstart()
  {
	  consoleLog("on_loadstart..."+videoElement.videoWidth+"X"+videoElement.videoHeight);
  }
  function on_play()
  {
	//  consoleLog("on_play..."+videoElement.videoWidth+"X"+videoElement.videoHeight);
  }
  function on_loadedmetadata()
  {
	  console.log("on_loadedmetadata..."+videoElement.videoWidth+"X"+videoElement.videoHeight);
 	if( videoElement.videoWidth>0 ){
 		videoElement.style.width = videoElement.videoWidth+"px";
 		videoElement.style.height = videoElement.videoHeight+"px";
 	}
 //	flvPlayer.play();
  }
  
  function on_FlvLoadingComplete()
  {
	  console.log("on_FlvLoadingComplete...");//
			  //+videoElement.videoWidth+"X"+videoElement.videoHeight);
		  
  }
  
  function startVideoPlay(){
	  document.getElementById("ErrInfo").textContent = ""; 
	  consolePane.clear();// DOM.remove(consoleDOM); 
	  var url = document.getElementById("VideoURL").value.trim();
	  console.log("url=%s",url);
	  if( flvPlayer ) {
		  flvPlayer.unload();
		  flvPlayer.detachMediaElement();
		  flvPlayer.destroy();
		  flvPlayer = null;

	  }
	  flvPlayer = flvjs.createPlayer({
          type: 'flv',
           url: url
      });
	  flvPlayer.on("loading_complete",on_FlvLoadingComplete);
	  flvPlayer.attachMediaElement(videoElement);
	 // flvPlayer.pause();
	 // flvPlayer.src = url;
	  flvPlayer.load();
	  videoElement.play();
		// flvPlayer.paly();
  };
  function stopVideoPlay(){
	  if( flvPlayer ) {
		  flvPlayer.unload();
		  flvPlayer.detachMediaElement();
		  flvPlayer.destroy();
		  flvPlayer = null;

	  }
  };
  */
  function startVideoPlay(){
	  document.getElementById("ErrInfo").textContent = ""; 
	  consolePane.clear();// DOM.remove(consoleDOM); 
	  var url = document.getElementById("VideoURL").value.trim();
	  console.log("url=%s",url);
	  videoPlayer.play(url);
	 
  };
  function stopVideoPlay(){
	  videoPlayer.stop();
  };
   window.onload = function(){
	   consolePane = new Xjs.ui.MessagePane({dom:document.getElementById("Console")});
	 //  videoElement = document.getElementById("video-player");
	  // videoElement.onloadstart = on_loadstart;
	  /*
	   flvPlayer = flvjs.createPlayer({
            type: 'flv'
         //  ,url: 'http://localhost/live/test1.flv'
        });
        flvPlayer.attachMediaElement(videoElement);
       // flvPlayer.load();
       */
       var url = Xjs.getReqParameter("url"); 
	   var padding = null;
	   if( url ) {
		   document.getElementById("InfoPane").style.display="none";
	   } else
	   {
		   padding = {width:16};
	   }
       videoPlayer = new snsoftx.video.FLVVideoPlay(null,{fitSize:1},url);
	   document.getElementById("VideoPlayBtn").onclick = startVideoPlay;
	   document.getElementById("VideoStopBtn").onclick = stopVideoPlay;
  };
  
</script>
<style type="text/css">
#ErrInfo { color:red;}
</style>
</head>

<body>
<div id="InfoPane">
<h4>FLV等播放视频 </h4>
视频地址:<br>
<textarea id="VideoURL" style="width:1000px;height:50px;border:1px solid blue;">
  http://localhost/live/test1.flv
 </textarea> <br> 
 <button id="VideoPlayBtn">播放</button>
 <button id="VideoStopBtn">停止</button><br>
 <div>
 http://localhost:8000/snsoft/touch-demos/oceans.mp4 (不支持)<br>
 http://localhost/live/test1.flv <br>
 http://localhost:8000/snsoft/ui/rtmp2flv/58.200.131.2:1935/livetv/hunantv <br>
 http://ivi.bupt.edu.cn/hls/cctv1hd.m3u8 (不支持)<br>
 </div>
 <div id="ErrInfo"></div>
 <div id="Console"></div>
 </div><video
    id="video-player"
    class="video-js"
    controls
    preload="auto"
    poster="../video/oceans.png"
    autoplay="true"
    >
     <source  type='video/x-flv'/>
</video>
</body>
</html>