<!DOCTYPE HTML>

<html class="ui-fullpage">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type='text/javascript' src='./xjslib/xjs-base.js'></script>
<link rel="icon" href="video-64.png"/>
<script type='text/javascript' src="./jslib/flvjs/flv.js"></script>

<title>视频播放</title>
<script type="text/javascript">
  /*
   http://caoyuwu.github.io/VideoPlayFLV.html
  */
  var consolePane ; 
   var videoElement;
   var flvPlayer;
   function consoleLog(s)
   {
	   consolePane.addMessage(s);
   }
  function onVideoPlayReady(){
	  window.console.log("onVideoPlayReady...");
	 // consoleLog("onVideoPlayReady...");
	  
  };
  
  function on_loadstart()
  {
	  consoleLog("on_loadstart..."+videoElement.videoWidth+"X"+videoElement.videoHeight);
  }
  function on_play()
  {
	//  consoleLog("on_play..."+videoElement.videoWidth+"X"+videoElement.videoHeight);
  }
  function on_loadedmetadata()
  {
	  console.log("on_loadedmetadata..."+videoElement.videoWidth+"X"+videoElement.videoHeight);
 	if( videoElement.videoWidth>0 ){
 		videoElement.style.width = videoElement.videoWidth+"px";
 		videoElement.style.height = videoElement.videoHeight+"px";
 	}
 //	flvPlayer.play();
  }
  
  function on_FlvLoadingComplete()
  {
	  console.log("on_FlvLoadingComplete...");//
			  //+videoElement.videoWidth+"X"+videoElement.videoHeight);
		  
  }
  
  function startVideoPlay(){
	  document.getElementById("ErrInfo").textContent = ""; 
	  consolePane.clear();// DOM.remove(consoleDOM); 
	  var url = document.getElementById("VideoURL").value.trim();
	  console.log("url=%s",url);
	  if( flvPlayer ) {
		  flvPlayer.unload();
		  flvPlayer.detachMediaElement();
		  flvPlayer.destroy();
		  flvPlayer = null;

	  }
	  flvPlayer = flvjs.createPlayer({
          type: 'flv',
           url: url
      });
	  flvPlayer.on("loading_complete",on_FlvLoadingComplete);
	  flvPlayer.attachMediaElement(videoElement);
	 // flvPlayer.pause();
	 // flvPlayer.src = url;
	  flvPlayer.load();
	  videoElement.play();
		// flvPlayer.paly();
  };
  function stopVideoPlay(){
	  if( flvPlayer ) {
		  flvPlayer.unload();
		  flvPlayer.detachMediaElement();
		  flvPlayer.destroy();
		  flvPlayer = null;

	  }
  };
   window.onload = function(){
	   consolePane = new Xjs.ui.MessagePane({dom:document.getElementById("Console")});
	   videoElement = document.getElementById("video-player");
	  // videoElement.onloadstart = on_loadstart;
	  /*
	   flvPlayer = flvjs.createPlayer({
            type: 'flv'
         //  ,url: 'http://localhost/live/test1.flv'
        });
        flvPlayer.attachMediaElement(videoElement);
       // flvPlayer.load();
       */
	   videoElement.onplay = on_play;
	   videoElement.onloadedmetadata = on_loadedmetadata;
	   document.getElementById("VideoPlayBtn").onclick = startVideoPlay;
	   document.getElementById("VideoStopBtn").onclick = stopVideoPlay;
  };
  
</script>
<style type="text/css">
#ErrInfo { color:red;}
</style>
</head>

<body>
视频地址:<br>
<textarea id="VideoURL" style="width:1000px;height:50px;border:1px solid blue;">
  http://localhost/live/test1.flv
 </textarea> <br> 
 <button id="VideoPlayBtn">播放</button>
 <button id="VideoStopBtn">停止</button><br>
 <div>
 http://localhost:8000/snsoft/touch-demos/oceans.mp4 <br>
 http://localhost/live/test1.flv <br>
 http://ivi.bupt.edu.cn/hls/cctv1hd.m3u8 <br>
 </div>
 <div id="ErrInfo"></div>
 <div id="Console"></div>
 <video
    id="video-player"
    class="video-js"
    controls
    preload="auto"
    poster="../video/oceans.png"
    autoplay="true"
    >
     <source  type='video/x-flv'/>
</video>
</body>
</html>